$:.unshift File.join(File.dirname(__FILE__), "..", "lib")
require "small_eigen_collider"

def determine_output_filename
  # FIXME be able to include the ruby implementation's version
  # FIXME should the output filename be chosen by the program like this?
  ruby_engine = defined?(RUBY_ENGINE) ? RUBY_ENGINE : "unknown_engine"
  output_filename = [ruby_engine, RUBY_VERSION, RUBY_PATCHLEVEL, "output.txt"].join("_")
  output_filename
end

logger = SmallEigenCollider::Logger.new_using_filename(determine_output_filename)
task_creator = SmallEigenCollider::TaskCreator.new
iterations = 2000

iterations.times do |i|

  # FIXME rather than using Object#inspect, I have to create a method whose output doesn't vary depending on object id
  # or ruby implementation

  logger.log_start
  task = task_creator.create_task

  logger.log_input_parameters(task)
  task.run
  task.log_result(logger)
  logger.log_end
end
logger.close
